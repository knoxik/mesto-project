(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};function t(e){e.classList.add("popup_opened"),document.addEventListener("keyup",n)}function r(e){document.removeEventListener("keyup",n),e.classList.remove("popup_opened")}function n(e){"Escape"==e.key&&L.forEach((function(e){r(e)}))}function o(e){e.classList.add("popup__button_loader")}function c(e){e.classList.remove("popup__button_loader")}e.d({},{OP:()=>E,EH:()=>L,ww:()=>I});var a={baseUrl:"https://nomoreparties.co/v1/plus-cohort-12",headers:{authorization:"40932e94-b782-4b92-ae2b-c3ef3a68c705","Content-Type":"application/json"}};function i(e,t){return t.owner._id==e._id}function u(e,t){var r=!1;return t.likes.forEach((function(t){t._id!=e._id||(r=!0)})),r}function s(e,t,r){var n=E.querySelector(".card-grid__item").cloneNode(!0),o=n.querySelector(".card-grid__image"),c=n.querySelector(".card-grid__like-counter"),a=n.querySelector(".card-grid__like-button"),i=n.querySelector(".card-grid__trash-btn");return t||i.remove(),n.dataset.like=!1,r&&(n.dataset.like=!0,a.classList.add("card-grid__like-button_active")),c.textContent=e.likes.length,o.src=e.link,o.alt=e.name,n.dataset.id=e._id,n.querySelector(".card-grid__title").textContent=e.name,n}function l(e,t){t.prepend(e)}function d(e,t){var r=e.querySelector(".card-grid__like-button"),n=e.querySelector(".card-grid__like-counter");r.classList.toggle("card-grid__like-button_active"),n.textContent=t.likes.length}var f=function(e,t,r){!function(e){return 0==e.length||e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(r.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(r.inactiveButtonClass),t.setAttribute("disabled",!0))},p=document.forms.editProfile,m=document.forms.updateAvatar,_=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),v=p.elements.profileName,b=p.elements.profileDescription,y=document.querySelector(".profile__avatar");function g(e){_.textContent=e.name,h.textContent=e.about,y.src=e.avatar}var S=document.querySelector(".content"),k=document.querySelector(".page__loader"),q=S.querySelector(".profile__edit-button"),L=document.querySelectorAll(".popup"),E=document.querySelector("#card-grid__item").content,P=document.forms.addPlace,C=S.querySelector(".profile__add-button"),j=P.elements.placeName,A=P.elements.placeLink,x=document.querySelector("#editProfilePopup"),U=document.querySelector("#addPlacePopup"),O=document.querySelector("#fullImagePopup"),T=O.querySelector(".popup__caption"),D=O.querySelector(".popup__image"),N=S.querySelector(".card-grid"),B=document.querySelector("#deleCardPopup"),w=B.querySelector(".popup__button"),H=void 0,J=S.querySelector(".profile__avatar-btn"),z=document.querySelector("#updateAvatarPopup"),I={formSelector:".form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_active"};(function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);f(r,n,t),r.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,r){t.validity.valid?function(e,t,r){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(r.inputErrorClass),n.classList.remove(r.errorClass),n.textContent=""}(e,t,r):function(e,t,r,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(e,t,t.validationMessage,r)}(e,o,t),f(r,n,t)}))}))}(t,e)}))})(I),fetch("".concat(a.baseUrl,"/cards"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)})).then((function(e){return function(e,t){return fetch("".concat(a.baseUrl,"/users/me"),{headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)})).then((function(r){for(var n=e.length-1;-1!==n;n--){var o=e[n];l(s(o,i(r,o),u(r,o)),t)}return r}))}(e,N)})).then((function(e){return g(e)})).then((function(){return k.remove()})),N.addEventListener("click",(function(e){var r=e.target;if(r.classList.contains("card-grid__like-button")){var n=r.closest(".card-grid__item"),o=n.dataset.id;"true"==n.dataset.like?function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e," "),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}(o).then((function(e){d(n,e),n.dataset.like=!1})):function(e){return fetch("".concat(a.baseUrl,"/cards/likes/").concat(e," "),{method:"PUT",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))}(o).then((function(e){d(n,e),n.dataset.like=!0}))}else if(r.classList.contains("card-grid__trash-btn"))H=r.closest(".card-grid__item"),t(B);else if(r.classList.contains("card-grid__image")){var c=r.closest(".card-grid__item").querySelector(".card-grid__title"),i=r.closest(".card-grid__image");T.textContent=c.textContent,D.src=i.src,D.alt=i.alt,t(O)}})),w.addEventListener("click",(function(e){var t,n;o(e.target),(t=H,(n=t.dataset.id,fetch("".concat(a.baseUrl,"/cards/").concat(n," "),{method:"DELETE",headers:a.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(){t.remove()}))).then((function(){return c(e.target)})).then((function(){return r(B)}))})),q.addEventListener("click",(function(e){v.value=_.textContent,b.value=h.textContent,t(x)})),C.addEventListener("click",(function(){t(U)})),p.addEventListener("submit",(function(e){var t,n;e.preventDefault(),o(e.submitter),(t=v.value,n=b.value,fetch("".concat(a.baseUrl,"/users/me"),{method:"PATCH",headers:a.headers,body:JSON.stringify({name:t,about:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(e){return g(e)})).then((function(){c(e.submitter),r(x)}))})),J.addEventListener("click",(function(){t(z)})),m.addEventListener("submit",(function(e){var t;e.preventDefault(),o(e.submitter),(t=m.elements.avatarLink.value,fetch("".concat(a.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:a.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(e){return g(e)})).then((function(){return c(e.submitter)})).then((function(){return r(updateAvatarPopup)})),f([],e.submitter,I),m.reset()})),P.addEventListener("submit",(function(e){var t,n;e.preventDefault(),o(e.submitter),f([],e.submitter,I),(t=j.value,n=A.value,fetch("".concat(a.baseUrl,"/cards"),{method:"POST",headers:a.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){return console.log(e)}))).then((function(t){l(s(t,!0,!1),N),c(e.submitter),r(U)})),P.reset()})),L.forEach((function(e){e.addEventListener("click",(function(e){var t=e.target;(t.classList.contains("popup__close-icon")||t.classList.contains("popup"))&&r(t.closest(".popup"))}))}))})();